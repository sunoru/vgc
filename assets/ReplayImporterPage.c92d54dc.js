import{ag as V,ah as Re,j as be,r as P,ai as Qe,c as S,w as ve,h as x,g as ye,q as He,aj as De,ak as Ue,Q as ze,V as xe,s as he,al as We,am as we,an as Ve,X as Ge,ao as Je,m as Be,z as Xe,o as Ze,A as Ye,y as et,I as tt,B as _e,C as qe,D as ce,d as W,L as at,af as Ke,E as rt,K as Te,ap as it,aq as lt}from"./index.971259e7.js";import{Q as nt,a as st,s as ue,b as ot}from"./dialog.b4393ef6.js";import{u as Ee,a as Ne}from"./use-dark.c30e6b86.js";import{Q as Ce,b as J,s as Pe,e as de,T as Me}from"./format.c71f507a.js";import{Q as ct}from"./QScrollObserver.1ed06e77.js";import{Q as ut}from"./QInput.a32df5b0.js";import{Q as dt}from"./QForm.ae43a80f.js";import{_ as ft}from"./PageBase.731eb462.js";import"./use-checkbox.e99e8ae6.js";import"./QPage.c2becd36.js";function me(e){return(""+e).toLowerCase().replace(/[^a-z0-9]+/g,"")}var pe=new class{constructor(){this.ARGS={"|init|":1,"|title|":1,"|userlist|":1,"||":1,"|html|":1,"|uhtml|":1,"|uhtmlchange|":1,"|join|":1,"|leave|":1,"|name|":1,"|chat|":1,"|notify|":1,"|:|":1,"|c:|":1,"|t:|":1,"|battle|":1,"|popup|":1,"|pm|":1,"|usercount|":1,"|nametaken|":1,"|challstr|":1,"|updateuser|":1,"|formats|":1,"|updatesearch|":1,"|message|":1,"|updatechallenges|":1,"|queryresponse|":1,"|unlink|":1,"|raw|":1,"|error|":1,"|bigerror|":1,"|chatmsg|":1,"|chatmsg-raw|":1,"|controlshtml|":1,"|fieldhtml|":1,"|debug|":1,"|deinit|":1,"|selectorhtml|":1,"|refresh|":1,"|tempnotify|":1,"|tempnotifyoff|":1,"|noinit|":1,"|hidelines|":1,"|expire|":1,"|askreg|":1,"|tournament|create|":1,"|tournament|update|":1,"|tournament|updateEnd|":1,"|tournament|error|":1,"|tournament|forceend|":1,"|tournament|join|":1,"|tournament|leave|":1,"|tournament|replace|":1,"|tournament|start|":1,"|tournament|disqualify|":1,"|tournament|battlestart|":1,"|tournament|battleend|":1,"|tournament|end|":1,"|tournament|scouting|":1,"|tournament|autostart|":1,"|tournament|autodq|":1,"|player|":1,"|teamsize|":1,"|gametype|":1,"|gen|":1,"|tier|":1,"|rated|":1,"|seed|":1,"|rule|":1,"|teampreview|":1,"|clearpoke|":1,"|poke|":1,"|start|":1,"|done|":1,"|request|":1,"|inactive|":1,"|inactiveoff|":1,"|upkeep|":1,"|turn|":1,"|win|":1,"|tie|":1,"|move|":1,"|switch|":1,"|drag|":1,"|detailschange|":1,"|replace|":1,"|swap|":1,"|cant|":1,"|faint|":1,"|-formechange|":1,"|-fail|":1,"|-block|":1,"|-notarget|":1,"|-miss|":1,"|-damage|":1,"|-heal|":1,"|-sethp|":1,"|-status|":1,"|-curestatus|":1,"|-cureteam|":1,"|-boost|":1,"|-unboost|":1,"|-setboost|":1,"|-swapboost|":1,"|-invertboost|":1,"|-clearboost|":1,"|-clearallboost|":1,"|-clearpositiveboost|":1,"|-ohko|":1,"|-clearnegativeboost|":1,"|-copyboost|":1,"|-weather|":1,"|-fieldstart|":1,"|-fieldend|":1,"|-sidestart|":1,"|-sideend|":1,"|-start|":1,"|-end|":1,"|-crit|":1,"|-supereffective|":1,"|-resisted|":1,"|-immune|":1,"|-item|":1,"|-enditem|":1,"|-ability|":1,"|-endability|":1,"|-transform|":1,"|-mega|":1,"|-primal|":1,"|-burst|":1,"|-zpower|":1,"|-zbroken|":1,"|-activate|":1,"|-fieldactivate|":1,"|-hint|":1,"|-center|":1,"|-message|":1,"|-combine|":1,"|-waiting|":1,"|-prepare|":1,"|-mustrecharge|":1,"|-hitcount|":1,"|-singlemove|":1,"|-singleturn|":1,"|-anim|":1,"|warning|":1,"|-candynamax|":1,"|updatepoke|":1,"|-swapsideconditions|":1,"|-terastallize|":1},this.ARGS_WITH_KWARGS={"|move|":1,"|detailschange|":1,"|cant|":1,"|-formechange|":1,"|-fail|":1,"|-block|":1,"|-damage|":1,"|-heal|":1,"|-sethp|":1,"|-status|":1,"|swap|":1,"|-curestatus|":1,"|-cureteam|":1,"|-boost|":1,"|-unboost|":1,"|-setboost|":1,"|-swapboost|":1,"|-invertboost|":1,"|-clearnegativeboost|":1,"|-weather|":1,"|-fieldactivate|":1,"|-fieldstart|":1,"|-fieldend|":1,"|-sidestart|":1,"|-sideend|":1,"|-start|":1,"|-end|":1,"|-immune|":1,"|-item|":1,"|-enditem|":1,"|-ability|":1,"|-endability|":1,"|-transform|":1,"|-activate|":1,"|-singleturn|":1,"|-miss|":1,"|-clearallboost|":1,"|-anim|":1,"|-copyboost|":1,"|-clearboost|":1,"|-clearpositiveboost|":1,"|-singlemove|":1,"|switch|":1}}*parse(e){const t=e.split(`
`);let r="";for(const[i,o]of t.entries())if(i===0&&o[0]===">"){r=o.slice(1);continue}else if(o){const{args:c,kwArgs:s}=this.parseBattleLine(o);yield{roomid:r,args:c,kwArgs:s}}}key(e){const t=e[0]==="tournament"?`|${e[0]}|${e[1]}|`:`|${e[0]}|`;return t in this.ARGS?t:void 0}parseLine(e,t){if(!e.startsWith("|"))return["",e];if(e==="|")return["done"];const r=e.indexOf("|",1),i=e.slice(1,r);switch(i){case"chatmsg":case"chatmsg-raw":case"raw":case"error":case"html":case"inactive":case"inactiveoff":case"warning":case"fieldhtml":case"controlshtml":case"bigerror":case"debug":case"tier":case"challstr":case"popup":case"":return G([i,e.slice(r+1)]);case"c":case"chat":case"uhtml":case"uhtmlchange":const o=e.indexOf("|",r+1);return G([i,e.slice(r+1,o),e.slice(o+1)]);case"c:":case"pm":const c=e.indexOf("|",r+1),s=e.indexOf("|",c+1);return G([i,e.slice(r+1,c),e.slice(c+1,s),e.slice(s+1)])}return t?null:G(e.slice(1).split("|"))}parseBattleLine(e){let t=pe.parseLine(e,!0);if(t)return{args:t,kwArgs:{}};t=e.slice(1).split("|");const r={};for(;t.length>1;){const i=t[t.length-1];if(i.charAt(0)!=="[")break;const o=i.indexOf("]");if(o<=0)break;r[i.slice(1,o)]=i.slice(o+1).trim()||!0,t.pop()}return yt({args:G(t),kwArgs:r})}parsePokemonIdent(e){const t=e.indexOf(":"),r=e.slice(0,t),i=e.slice(t+2);let o,c;return r.length<3?(o=r,c=null):(o=r.slice(0,2),c=r.charAt(2)),{player:o,position:c,name:i}}parseDetails(e,t,r="",i={}){i.details=r;const o=!e;i.name=e,i.speciesForme=e,i.level=100,i.shiny=!1,i.gender=void 0,i.ident=o?"":t,i.searchid=o?"":`${t}|${r}`;const c=r.split(", ");c[c.length-1].startsWith("tera:")&&(i.terastallized=c[c.length-1].slice(5),c.pop()),c[c.length-1]==="shiny"&&(i.shiny=!0,c.pop());const s=c[c.length-1];return(s==="M"||s==="F")&&(i.gender=s,c.pop()),c[1]&&(i.level=parseInt(c[1].substr(1))||100),c[0]&&(i.speciesForme=c[0]),i}parseHealth(e,t={}){const[r,i]=e.split(" ");if(t.hpcolor="",r==="0"||r==="0.0")t.maxhp||(t.maxhp=100),t.hp=0;else if(r.indexOf("/")>0){const[o,c]=r.split("/");if(isNaN(parseFloat(o))||isNaN(parseFloat(c)))return null;t.hp=parseFloat(o),t.maxhp=parseFloat(c),t.hp>t.maxhp&&(t.hp=t.maxhp);const s=c.slice(-1);(s==="y"||s==="g")&&(t.hpcolor=s)}else isNaN(parseFloat(r))||(t.maxhp||(t.maxhp=100),t.hp=t.maxhp*parseFloat(r)/100);return i?i==="par"||i==="brn"||i==="slp"||i==="frz"||i==="tox"||i==="psn"&&t.status!=="tox"?t.status=i:i==="fnt"&&(t.hp=0,t.fainted=!0):t.status=void 0,t}parseEffect(e,t=r=>r.trim()){return e?e.startsWith("item:")||e.startsWith("move:")?{name:t(e.slice(5)),type:e.slice(0,4)}:e.startsWith("ability:")?{name:t(e.slice(8)),type:"ability"}:{name:t(e)}:{name:t("")}}parseRequest(e){const t=JSON.parse(e);if(t.requestType||(t.requestType="move",t.forceSwitch?t.requestType="switch":t.teamPreview?t.requestType="team":t.wait&&(t.requestType="wait")),t.requestType==="wait"&&(t.noCancel=!0),t.side)for(const r of t.side.pokemon)this.parseDetails(r.ident.substr(4),r.ident,r.details,r),this.parseHealth(r.condition,r),r.ability=r.ability||r.baseAbility;if(t.active){t.active=t.active.map((r,i)=>t.side.pokemon[i].fainted?null:r);for(const r of t.active)if(!!r){for(const i of r.moves)i.move&&(i.name=i.move),i.id=me(i.name);if(r.maxMoves){r.maxMoves.maxMoves&&(r.canGigantamax=r.maxMoves.gigantamax,r.maxMoves=r.maxMoves.maxMoves);for(const i of r.maxMoves)i.id=i.move}if(r.canZMove){r.zMoves=r.canZMove;for(const i of r.zMoves)!i||(i.move&&(i.name=i.move),i.id=me(i.name))}}}return t}parseChallenges(e){return JSON.parse(e)}parseSearchState(e){return JSON.parse(e)}parseTournamentUpdate(e){return JSON.parse(e)}parseNameParts(e){let t="";/[A-Za-z0-9]/.test(e.charAt(0))||(t=e.charAt(0),e=e.slice(1));let r=e;const i=e.indexOf("@");let o="",c=!1;return i>0&&(r=e.slice(0,i),o=e.slice(i+1),o.startsWith("!")&&(c=!0,o=o.slice(1))),{group:t,name:r,away:c,status:o}}};function G(e){switch(e[0]){case"name":case"n":case"N":{const[t,r,i]=e;return["name",r,i,t==="N"]}case"chat":case"c":{const[,t,r]=e;return["chat",t,r]}case"join":case"j":case"J":{const[t,r]=e;return["join",r,t==="J"]}case"leave":case"l":case"L":{const[t,r]=e;return["leave",r,t==="L"]}case"battle":case"b":{const[,t,r,i]=e;return["battle",t,r,i]}}return e}var vt=new Set(["ingrain","quickguard","wideguard","craftyshield","matblock","protect","mist","safeguard","electricterrain","mistyterrain","psychicterrain","telepathy","stickyhold","suctioncups","aromaveil","flowerveil","sweetveil","disguise","safetygoggles","protectivepads"]),ht=new Set(["ability: Damp","ability: Dazzling","ability: Queenly Majesty","ability: Armor Tail"]),mt=new Set(["thundercage","clamp","whirlpool","firespin","magmastorm","sandtomb","infestation","trapped","bind","snaptrap","wrap"]),bt=new Set(["eeriespell","gmaxdepletion","spite","grudge","forewarn","sketch","leppaberry","mysteryberry"]);function yt({args:e,kwArgs:t}){switch(e[0]){case"-activate":{if(t.item||t.move||t.number||t.ability)return{args:e,kwArgs:t};const[,r,i,o,c]=e,s=i,a=t.of,b=pe.parseEffect(s,me).name;if(t.block)return{args:["-fail",r],kwArgs:t};if(b==="sturdy")return{args:["-activate",r,"ability: Sturdy"],kwArgs:t};if(b==="wonderguard")return{args:["-immune",r],kwArgs:{from:"ability: Wonder Guard"}};if(b==="beatup"&&t.of)return{args:e,kwArgs:{name:t.of}};if(vt.has(b))return a?(t.of=r,{args:["-block",a,s,o||""],kwArgs:t}):{args:["-block",r,s,o||""],kwArgs:t};if(b==="charge")return{args:["-singlemove",r,"Charge"],kwArgs:{of:a||void 0}};if(mt.has(b))return{args:["-start",r,s],kwArgs:{of:a||""}};if(b==="fairylock")return{args:["-fieldactivate",s],kwArgs:{}};if(b==="symbiosis"||b==="poltergeist")t.item=o;else if(b==="magnitude")t.number=o;else if(b==="skillswap"||b==="mummy"||b==="lingeringaroma")t.ability=o,t.ability2=c;else if(b==="wanderingspirit")if(o)t.ability=o,t.ability2=c;else return{args:["-ability",r,"Wandering Spirit"],kwArgs:{}};else bt.has(b)&&(t.move=o,t.number=c);return{args:["-activate",r,s,a||""],kwArgs:t}}case"-start":{(t.from==="Protean"||t.from==="Color Change")&&(t.from="ability:"+t.from);break}case"move":{t.from==="Magic Bounce"&&(t.from="ability: Magic Bounce");break}case"cant":{const[,r,i,o]=e;if(ht.has(i))return{args:["-block",r,i,o,t.of||""],kwArgs:{}};break}case"gen":{const[,r]=e;return{args:["gen",Number(r)],kwArgs:{}}}case"-nothing":e=["-activate","","move: Splash"]}return{args:e,kwArgs:t}}const ae=e=>{if(e=e.slice(0,2),e==="p1")return!0;if(e==="p2")return!1;throw new Error("Only two player battles are supported.")},pt=(e,t)=>{if(t.has(e))return t.get(e);const r={id:e.split(",")[0],moves:[],sentOutOrder:t.size};return t.set(e,r),r},Ae=(e,t,r)=>{if(!(r in e))return;const i=e[r],[o,c]=t.split(":");switch(o.trim()){case"item":if(i.item)break;i.item=c.trim();break;case"ability":if(i.ability)break;i.ability=c.trim();break}},gt=async(e,t={})=>{var B;const r=[],i=[],o=new Map,c=new Map,s={},a={remarks:t.remarks,tags:((B=t.tags)==null?void 0:B.map(M=>M.trim()))||[],team1:r,team2:i};let b=0;for await(const M of pe.parse(e)){const{args:m}=M,y=m[0];if(y==="t:"&&(a.time||(a.time=parseInt(m[1])*1e3)),y==="player"){const[,v,h,,T]=m,k=T?parseInt(T):0;ae(v)?(a.p1=h,a.rating1=k):(a.p2=h,a.rating2=k)}else if(y==="poke"){const v=m[2].split(",")[0];ae(m[1])?r.push(v):i.push(v)}else if(y==="switch"||y==="drag"){const[,v,h]=m,T=pt(h,ae(v)?o:c);s[v]=T}else if(y==="-ability"){const[,v,h]=m;s[v].ability=h}else if(y==="-terastallize"){const[,v,h]=m;s[v].teraType=h}else if(y==="move"){const[,v,h]=m,T=s[v].moves;T.includes(h)||T.push(h)}else if(y==="-enditem"){const[,v,h]=m;s[v].item=h}else if(y==="-activate"){const[,v,h]=m;v&&(h.startsWith("item:")?s[v].item=h.slice(5).trim():h.startsWith("ability:")&&(s[v].ability=h.slice(8).trim()))}else if(y==="detailschange"){const[,v,h]=m,T=ae(v)?o:c,k=s[v];let q;for(const[C,j]of T.entries())if(j===k){q=C;break}q&&T.delete(q),T.set(h,k)}else if(y==="turn")b=parseInt(m[1]);else if(y==="win")a.winner=m[1]===a.p1?V.Player1:V.Player2;else if("from"in M.kwArgs)if("of"in M.kwArgs)Ae(s,M.kwArgs.from,M.kwArgs.of);else{const[,v]=m;Ae(s,M.kwArgs.from,v)}}const K=(M,m)=>M.sentOutOrder-m.sentOutOrder;return a.team1SentOut=Array.from(o.values()).sort(K),a.team2SentOut=Array.from(c.values()).sort(K),a.numTurns=b,t.whichIsUserPlayer&&a.p1&&a.p2?a.userPlayer=await t.whichIsUserPlayer(a.p1,a.p2):a.userPlayer=V.Unknown,a.timeParsed=Date.now(),new Re(a)},kt=async(e,t={})=>{const r=t.password;let i=e.match(/^https?:\/\//i)?e:`https://replay.pokemonshowdown.com/${e}${r?`-${r}`:""}`;i.endsWith(".json")&&(i=i.slice(0,-5)),i.endsWith(".log")&&(i=i.slice(0,-4));const o=`${i}.json`,s=await(await fetch(o)).json(),a=s.log,b=await gt(a,t);return b.id=s.id,b.url=i,b},St=["none","strict","leaf","leaf-filtered"];var zt=be({name:"QTree",props:{...Ee,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:e=>St.includes(e)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(e,{slots:t,emit:r}){const{proxy:i}=ye(),{$q:o}=i,c=Ne(e,o),s=P({}),a=P(e.ticked||[]),b=P(e.expanded||[]);let K={};Qe(()=>{K={}});const B=S(()=>`q-tree q-tree--${e.dense===!0?"dense":"standard"}`+(e.noConnectors===!0?" q-tree--no-connectors":"")+(c.value===!0?" q-tree--dark":"")+(e.color!==void 0?` text-${e.color}`:"")),M=S(()=>e.selected!==void 0),m=S(()=>e.icon||o.iconSet.tree.icon),y=S(()=>e.controlColor||e.color),v=S(()=>e.textColor!==void 0?` text-${e.textColor}`:""),h=S(()=>{const n=e.selectedColor||e.color;return n?` text-${n}`:""}),T=S(()=>e.filterMethod!==void 0?e.filterMethod:(n,d)=>{const l=d.toLowerCase();return n[e.labelKey]&&n[e.labelKey].toLowerCase().indexOf(l)>-1}),k=S(()=>{const n={},d=(l,g)=>{const f=l.tickStrategy||(g?g.tickStrategy:e.tickStrategy),_=l[e.nodeKey],A=l[e.childrenKey]&&Array.isArray(l[e.childrenKey])&&l[e.childrenKey].length!==0,D=l.disabled!==!0&&M.value===!0&&l.selectable!==!1,O=l.disabled!==!0&&l.expandable!==!1,Le=f!=="none",te=f==="strict",ke=f==="leaf-filtered",se=f==="leaf"||f==="leaf-filtered";let oe=l.disabled!==!0&&l.tickable!==!1;se===!0&&oe===!0&&g&&g.tickable!==!0&&(oe=!1);let U=l.lazy;U===!0&&s.value[_]!==void 0&&Array.isArray(l[e.childrenKey])===!0&&(U=s.value[_]);const z={key:_,parent:g,isParent:A,lazy:U,disabled:l.disabled,link:l.disabled!==!0&&(D===!0||O===!0&&(A===!0||U===!0)),children:[],matchesFilter:e.filter?T.value(l,e.filter):!0,selected:_===e.selected&&D===!0,selectable:D,expanded:A===!0?b.value.includes(_):!1,expandable:O,noTick:l.noTick===!0||te!==!0&&U&&U!=="loaded",tickable:oe,tickStrategy:f,hasTicking:Le,strictTicking:te,leafFilteredTicking:ke,leafTicking:se,ticked:te===!0?a.value.includes(_):A===!0?!1:a.value.includes(_)};if(n[_]=z,A===!0&&(z.children=l[e.childrenKey].map($=>d($,z)),e.filter&&(z.matchesFilter!==!0?z.matchesFilter=z.children.some($=>$.matchesFilter):z.noTick!==!0&&z.disabled!==!0&&z.tickable===!0&&ke===!0&&z.children.every($=>$.matchesFilter!==!0||$.noTick===!0||$.tickable!==!0)===!0&&(z.tickable=!1)),z.matchesFilter===!0&&(z.noTick!==!0&&te!==!0&&z.children.every($=>$.noTick)===!0&&(z.noTick=!0),se))){if(z.ticked=!1,z.indeterminate=z.children.some($=>$.indeterminate===!0),z.tickable=z.tickable===!0&&z.children.some($=>$.tickable),z.indeterminate!==!0){const $=z.children.reduce((Se,Ie)=>Ie.ticked===!0?Se+1:Se,0);$===z.children.length?z.ticked=!0:$>0&&(z.indeterminate=!0)}z.indeterminate===!0&&(z.indeterminateNextState=z.children.every($=>$.tickable!==!0||$.ticked!==!0))}return z};return e.nodes.forEach(l=>d(l,null)),n});ve(()=>e.ticked,n=>{a.value=n}),ve(()=>e.expanded,n=>{b.value=n});function q(n){const d=[].reduce,l=(g,f)=>{if(g||!f)return g;if(Array.isArray(f)===!0)return d.call(Object(f),l,g);if(f[e.nodeKey]===n)return f;if(f[e.childrenKey])return l(null,f[e.childrenKey])};return l(null,e.nodes)}function C(){return a.value.map(n=>q(n))}function j(){return b.value.map(n=>q(n))}function E(n){return n&&k.value[n]?k.value[n].expanded:!1}function R(){e.expanded!==void 0?r("update:expanded",[]):b.value=[]}function F(){const n=[],d=l=>{l[e.childrenKey]&&l[e.childrenKey].length!==0&&l.expandable!==!1&&l.disabled!==!0&&(n.push(l[e.nodeKey]),l[e.childrenKey].forEach(d))};e.nodes.forEach(d),e.expanded!==void 0?r("update:expanded",n):b.value=n}function Q(n,d,l=q(n),g=k.value[n]){if(g.lazy&&g.lazy!=="loaded"){if(g.lazy==="loading")return;s.value[n]="loading",Array.isArray(l[e.childrenKey])!==!0&&(l[e.childrenKey]=[]),r("lazyLoad",{node:l,key:n,done:f=>{s.value[n]="loaded",l[e.childrenKey]=Array.isArray(f)===!0?f:[],He(()=>{const _=k.value[n];_&&_.isParent===!0&&Z(n,!0)})},fail:()=>{delete s.value[n],l[e.childrenKey].length===0&&delete l[e.childrenKey]}})}else g.isParent===!0&&g.expandable===!0&&Z(n,d)}function Z(n,d){let l=b.value;const g=e.expanded!==void 0;if(g===!0&&(l=l.slice()),d){if(e.accordion&&k.value[n]){const f=[];k.value[n].parent?k.value[n].parent.children.forEach(_=>{_.key!==n&&_.expandable===!0&&f.push(_.key)}):e.nodes.forEach(_=>{const A=_[e.nodeKey];A!==n&&f.push(A)}),f.length!==0&&(l=l.filter(_=>f.includes(_)===!1))}l=l.concat([n]).filter((f,_,A)=>A.indexOf(f)===_)}else l=l.filter(f=>f!==n);g===!0?r("update:expanded",l):b.value=l}function ie(n){return n&&k.value[n]?k.value[n].ticked:!1}function L(n,d){let l=a.value;const g=e.ticked!==void 0;g===!0&&(l=l.slice()),d?l=l.concat(n).filter((f,_,A)=>A.indexOf(f)===_):l=l.filter(f=>n.includes(f)===!1),g===!0&&r("update:ticked",l)}function Y(n,d,l){const g={tree:i,node:n,key:l,color:e.color,dark:c.value};return we(g,"expanded",()=>d.expanded,f=>{f!==d.expanded&&Q(l,f)}),we(g,"ticked",()=>d.ticked,f=>{f!==d.ticked&&L([l],f)}),g}function ee(n){return(e.filter?n.filter(d=>k.value[d[e.nodeKey]].matchesFilter):n).map(d=>p(d))}function le(n){if(n.icon!==void 0)return x(ze,{class:"q-tree__icon q-mr-sm",name:n.icon,color:n.iconColor});const d=n.img||n.avatar;if(d)return x("img",{class:`q-tree__${n.img?"img":"avatar"} q-mr-sm`,src:d})}function H(){r("afterShow")}function u(){r("afterHide")}function p(n){const d=n[e.nodeKey],l=k.value[d],g=n.header&&t[`header-${n.header}`]||t["default-header"],f=l.isParent===!0?ee(n[e.childrenKey]):[],_=f.length!==0||l.lazy&&l.lazy!=="loaded";let A=n.body&&t[`body-${n.body}`]||t["default-body"];const D=g!==void 0||A!==void 0?Y(n,l,d):null;return A!==void 0&&(A=x("div",{class:"q-tree__node-body relative-position"},[x("div",{class:v.value},[A(D)])])),x("div",{key:d,class:`q-tree__node relative-position q-tree__node--${_===!0?"parent":"child"}`},[x("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(l.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(l.selected===!0?" q-tree__node--selected":"")+(l.disabled===!0?" q-tree__node--disabled":""),tabindex:l.link===!0?0:-1,onClick:O=>{N(n,l,O)},onKeypress(O){De(O)!==!0&&(O.keyCode===13?N(n,l,O,!0):O.keyCode===32&&I(n,l,O,!0))}},[x("div",{class:"q-focus-helper",tabindex:-1,ref:O=>{K[l.key]=O}}),l.lazy==="loading"?x(Ue,{class:"q-tree__spinner",color:y.value}):_===!0?x(ze,{class:"q-tree__arrow"+(l.expanded===!0?" q-tree__arrow--rotate":""),name:m.value,onClick(O){I(n,l,O)}}):null,l.hasTicking===!0&&l.noTick!==!0?x(nt,{class:"q-tree__tickbox",modelValue:l.indeterminate===!0?null:l.ticked,color:y.value,dark:c.value,dense:!0,keepColor:!0,disable:l.tickable!==!0,onKeydown:xe,"onUpdate:modelValue":O=>{ne(l,O)}}):null,x("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(l.selected===!0?h.value:v.value)},[g?g(D):[le(n),x("div",n[e.labelKey])]])]),_===!0?e.noTransition===!0?x("div",{class:"q-tree__node-collapsible"+v.value,key:`${d}__q`},[A,x("div",{class:"q-tree__children"+(l.disabled===!0?" q-tree__node--disabled":"")},l.expanded?f:null)]):x(st,{duration:e.duration,onShow:H,onHide:u},()=>he(x("div",{class:"q-tree__node-collapsible"+v.value,key:`${d}__q`},[A,x("div",{class:"q-tree__children"+(l.disabled===!0?" q-tree__node--disabled":"")},f)]),[[We,l.expanded]])):A])}function w(n){const d=K[n];d&&d.focus()}function N(n,d,l,g){g!==!0&&d.selectable!==!1&&w(d.key),M.value&&d.selectable?e.noSelectionUnset===!1?r("update:selected",d.key!==e.selected?d.key:null):d.key!==e.selected&&r("update:selected",d.key===void 0?null:d.key):I(n,d,l,g),typeof n.handler=="function"&&n.handler(n)}function I(n,d,l,g){l!==void 0&&xe(l),g!==!0&&d.selectable!==!1&&w(d.key),Q(d.key,!d.expanded,n,d)}function ne(n,d){if(n.indeterminate===!0&&(d=n.indeterminateNextState),n.strictTicking)L([n.key],d);else if(n.leafTicking){const l=[],g=f=>{f.isParent?(d!==!0&&f.noTick!==!0&&f.tickable===!0&&l.push(f.key),f.leafTicking===!0&&f.children.forEach(g)):f.noTick!==!0&&f.tickable===!0&&(f.leafFilteredTicking!==!0||f.matchesFilter===!0)&&l.push(f.key)};g(n),L(l,d)}}return e.defaultExpandAll===!0&&F(),Object.assign(i,{getNodeByKey:q,getTickedNodes:C,getExpandedNodes:j,isExpanded:E,collapseAll:R,expandAll:F,setExpanded:Q,isTicked:ie,setTicked:L}),()=>{const n=ee(e.nodes);return x("div",{class:B.value},n.length===0?e.filter?e.noResultsLabel||o.lang.tree.noResults:e.noNodesLabel||o.lang.tree.noNodes:n)}}});const $e=["vertical","horizontal"],fe={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},je={prevent:!0,mouse:!0,mouseAllDir:!0},Oe=e=>e>=250?50:Math.ceil(e/5);var xt=be({name:"QScrollArea",props:{...Ee,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:r}){const i=P(!1),o=P(!1),c=P(!1),s={vertical:P(0),horizontal:P(0)},a={vertical:{ref:P(null),position:P(0),size:P(0)},horizontal:{ref:P(null),position:P(0),size:P(0)}},{proxy:b}=ye(),K=Ne(e,b.$q);let B=null,M;const m=P(null),y=S(()=>"q-scrollarea"+(K.value===!0?" q-scrollarea--dark":""));a.vertical.percentage=S(()=>{const u=a.vertical.size.value-s.vertical.value;if(u<=0)return 0;const p=J(a.vertical.position.value/u,0,1);return Math.round(p*1e4)/1e4}),a.vertical.thumbHidden=S(()=>(e.visible===null?c.value:e.visible)!==!0&&i.value===!1&&o.value===!1||a.vertical.size.value<=s.vertical.value+1),a.vertical.thumbStart=S(()=>a.vertical.percentage.value*(s.vertical.value-a.vertical.thumbSize.value)),a.vertical.thumbSize=S(()=>Math.round(J(s.vertical.value*s.vertical.value/a.vertical.size.value,Oe(s.vertical.value),s.vertical.value))),a.vertical.style=S(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${a.vertical.thumbStart.value}px`,height:`${a.vertical.thumbSize.value}px`})),a.vertical.thumbClass=S(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.vertical.barClass=S(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),a.horizontal.percentage=S(()=>{const u=a.horizontal.size.value-s.horizontal.value;if(u<=0)return 0;const p=J(Math.abs(a.horizontal.position.value)/u,0,1);return Math.round(p*1e4)/1e4}),a.horizontal.thumbHidden=S(()=>(e.visible===null?c.value:e.visible)!==!0&&i.value===!1&&o.value===!1||a.horizontal.size.value<=s.horizontal.value+1),a.horizontal.thumbStart=S(()=>a.horizontal.percentage.value*(s.horizontal.value-a.horizontal.thumbSize.value)),a.horizontal.thumbSize=S(()=>Math.round(J(s.horizontal.value*s.horizontal.value/a.horizontal.size.value,Oe(s.horizontal.value),s.horizontal.value))),a.horizontal.style=S(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[b.$q.lang.rtl===!0?"right":"left"]:`${a.horizontal.thumbStart.value}px`,width:`${a.horizontal.thumbSize.value}px`})),a.horizontal.thumbClass=S(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.horizontal.barClass=S(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const v=S(()=>a.vertical.thumbHidden.value===!0&&a.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),h=[[Me,u=>{F(u,"vertical")},void 0,{vertical:!0,...je}]],T=[[Me,u=>{F(u,"horizontal")},void 0,{horizontal:!0,...je}]];function k(){const u={};return $e.forEach(p=>{const w=a[p];u[p+"Position"]=w.position.value,u[p+"Percentage"]=w.percentage.value,u[p+"Size"]=w.size.value,u[p+"ContainerSize"]=s[p].value}),u}const q=Ve(()=>{const u=k();u.ref=b,r("scroll",u)},0);function C(u,p,w){if($e.includes(u)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(u==="vertical"?Pe:de)(m.value,p,w)}function j({height:u,width:p}){let w=!1;s.vertical.value!==u&&(s.vertical.value=u,w=!0),s.horizontal.value!==p&&(s.horizontal.value=p,w=!0),w===!0&&L()}function E({position:u}){let p=!1;a.vertical.position.value!==u.top&&(a.vertical.position.value=u.top,p=!0),a.horizontal.position.value!==u.left&&(a.horizontal.position.value=u.left,p=!0),p===!0&&L()}function R({height:u,width:p}){a.horizontal.size.value!==p&&(a.horizontal.size.value=p,L()),a.vertical.size.value!==u&&(a.vertical.size.value=u,L())}function F(u,p){const w=a[p];if(u.isFirst===!0){if(w.thumbHidden.value===!0)return;M=w.position.value,o.value=!0}else if(o.value!==!0)return;u.isFinal===!0&&(o.value=!1);const N=fe[p],I=s[p].value,ne=(w.size.value-I)/(I-w.thumbSize.value),n=u.distance[N.dist],d=M+(u.direction===N.dir?1:-1)*n*ne;Y(d,p)}function Q(u,p){const w=a[p];if(w.thumbHidden.value!==!0){const N=u[fe[p].offset];if(N<w.thumbStart.value||N>w.thumbStart.value+w.thumbSize.value){const I=N-w.thumbSize.value/2;Y(I/s[p].value*w.size.value,p)}w.ref.value!==null&&w.ref.value.dispatchEvent(new MouseEvent(u.type,u))}}function Z(u){Q(u,"vertical")}function ie(u){Q(u,"horizontal")}function L(){i.value=!0,B!==null&&clearTimeout(B),B=setTimeout(()=>{B=null,i.value=!1},e.delay),e.onScroll!==void 0&&q()}function Y(u,p){m.value[fe[p].scroll]=u}function ee(){c.value=!0}function le(){c.value=!1}let H=null;return ve(()=>b.$q.lang.rtl,u=>{m.value!==null&&de(m.value,Math.abs(a.horizontal.position.value)*(u===!0?-1:1))}),Ge(()=>{H={top:a.vertical.position.value,left:a.horizontal.position.value}}),Je(()=>{if(H===null)return;const u=m.value;u!==null&&(de(u,H.left),Pe(u,H.top))}),Be(q.cancel),Object.assign(b,{getScrollTarget:()=>m.value,getScroll:k,getScrollPosition:()=>({top:a.vertical.position.value,left:a.horizontal.position.value}),getScrollPercentage:()=>({top:a.vertical.percentage.value,left:a.horizontal.percentage.value}),setScrollPosition:C,setScrollPercentage(u,p,w){C(u,p*(a[u].size.value-s[u].value)*(u==="horizontal"&&b.$q.lang.rtl===!0?-1:1),w)}}),()=>x("div",{class:y.value,onMouseenter:ee,onMouseleave:le},[x("div",{ref:m,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[x("div",{class:"q-scrollarea__content absolute",style:v.value},Xe(t.default,[x(Ce,{debounce:0,onResize:R})])),x(ct,{axis:"both",onScroll:E})]),x(Ce,{debounce:0,onResize:j}),x("div",{class:a.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Z}),x("div",{class:a.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:ie}),he(x("div",{ref:a.vertical.ref,class:a.vertical.thumbClass.value,style:a.vertical.style.value,"aria-hidden":"true"}),h),he(x("div",{ref:a.horizontal.ref,class:a.horizontal.thumbClass.value,style:a.horizontal.style.value,"aria-hidden":"true"}),T)])}});const ge=XMLHttpRequest,Fe=ge.prototype.open,wt=["top","right","bottom","left"];let re=[],X=0;function _t({p:e,pos:t,active:r,horiz:i,reverse:o,dir:c}){let s=1,a=1;return i===!0?(o===!0&&(s=-1),t==="bottom"&&(a=-1),{transform:`translate3d(${s*(e-100)}%,${r?0:a*-200}%,0)`}):(o===!0&&(a=-1),t==="right"&&(s=-1),{transform:`translate3d(${r?0:c*s*-200}%,${a*(e-100)}%,0)`})}function qt(e,t){return typeof t!="number"&&(e<25?t=Math.random()*3+3:e<65?t=Math.random()*3:e<85?t=Math.random()*2:e<99?t=.6:t=0),J(e+t,0,100)}function Tt(e){X++,re.push(e),!(X>1)&&(ge.prototype.open=function(t,r){const i=[],o=()=>{re.forEach(s=>{(s.hijackFilter.value===null||s.hijackFilter.value(r)===!0)&&(s.start(),i.push(s.stop))})},c=()=>{i.forEach(s=>{s()})};this.addEventListener("loadstart",o,{once:!0}),this.addEventListener("loadend",c,{once:!0}),Fe.apply(this,arguments)})}function Ct(e){re=re.filter(t=>t.start!==e),X=Math.max(0,X-1),X===0&&(ge.prototype.open=Fe)}var Pt=be({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:e=>wt.includes(e)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(e,{emit:t}){const{proxy:r}=ye(),i=P(0),o=P(!1),c=P(!0);let s=0,a=null,b;const K=S(()=>`q-loading-bar q-loading-bar--${e.position}`+(e.color!==void 0?` bg-${e.color}`:"")+(c.value===!0?"":" no-transition")),B=S(()=>e.position==="top"||e.position==="bottom"),M=S(()=>B.value===!0?"height":"width"),m=S(()=>{const C=o.value,j=_t({p:i.value,pos:e.position,active:C,horiz:B.value,reverse:r.$q.lang.rtl===!0&&["top","bottom"].includes(e.position)?e.reverse===!1:e.reverse,dir:r.$q.lang.rtl===!0?-1:1});return j[M.value]=e.size,j.opacity=C?1:0,j}),y=S(()=>o.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":i.value}:{"aria-hidden":"true"});function v(C=300){const j=b;return b=Math.max(0,C)||0,s++,s>1?(j===0&&C>0?k():a!==null&&j>0&&C<=0&&(clearTimeout(a),a=null),s):(a!==null&&clearTimeout(a),t("start"),i.value=0,a=setTimeout(()=>{a=null,c.value=!0,C>0&&k()},o.value===!0?500:1),o.value!==!0&&(o.value=!0,c.value=!1),s)}function h(C){return s>0&&(i.value=qt(i.value,C)),s}function T(){if(s=Math.max(0,s-1),s>0)return s;a!==null&&(clearTimeout(a),a=null),t("stop");const C=()=>{c.value=!0,i.value=100,a=setTimeout(()=>{a=null,o.value=!1},1e3)};return i.value===0?a=setTimeout(C,1):C(),s}function k(){i.value<100&&(a=setTimeout(()=>{a=null,h(),k()},b))}let q;return Ze(()=>{e.skipHijack!==!0&&(q=!0,Tt({start:v,stop:T,hijackFilter:S(()=>e.hijackFilter||null)}))}),Be(()=>{a!==null&&clearTimeout(a),q===!0&&Ct(v)}),Object.assign(r,{start:v,stop:T,increment:h}),()=>x("div",{class:K.value,style:m.value,...y.value})}});const Mt={class:"q-pa-md col",style:{"max-width":"720px"}},At=Ke("div",{class:"text-h3"},"Replay Importer",-1),Rt=Ye({__name:"ReplayImporterPage",setup(e){const t=P(),r=P(""),i=P(!1),o=et([]),c=()=>{o.splice(0)},s=S(()=>{const m=[],y=[],v=[];for(const h of o)h.failed?v.push({key:v.length,label:`${h.url}	${h.remarks}	${h.tags.join(",")}`}):h.skipped?y.push({key:y.length,label:h.battle?h.battle.id:h.url,url:h.url}):h.battle&&m.push({key:m.length,label:h.battle.id,url:h.url});return[{key:"succeeded",label:`Succeeded (${m.length})`,children:m},{key:"skipped",label:`Skipped (${y.length})`,children:y},{key:"failed",label:`Failed (${v.length})`,children:v}]}),a=P(["root","failed"]),b=tt().config,K=async(m,y,v)=>{const h=m.pathname.match(/^\/(?<id>[0-9a-z]+?-\d+?)(-(?<password>[0-9a-z]+?))?$/),T=m.toString();if(h!==null&&h.groups){const k=h.groups.id,q=await it("battles",k);if(q!==null)return{battle:q,url:T,skipped:!0}}try{const k=await kt(m.href,{remarks:y,tags:v,whichIsUserPlayer:async(q,C)=>{const j=b.showdownUsernames;if(j.includes(q))return V.Player1;if(j.includes(C))return V.Player2;const E=await ot("Which is your username?","Nither of them",q,C);return E!==0&&b.showdownUsernames.push(E===V.Player1?q:C),E}});return await lt("battles",k),{battle:k,url:T}}catch(k){return console.error(k),{url:T,remarks:y,tags:v,failed:!0}}},B=async m=>{var k;const y=m.split(`
`),v=100/y.length;let h=0,T=0;for(let q of y){if((k=t.value)==null||k.increment(v),q=q.trim(),q==="")continue;const[C,j,E]=q.split("	");try{const R=new URL(C);T+=1;const F=await K(R,j,(E==null?void 0:E.split(","))||[]);F.battle&&!F.skipped&&(h+=1),o.push(F)}catch(R){console.error(R);continue}}return[h,T]},M=async()=>{if(!!t.value){i.value=!0,t.value.start(0);try{const m=r.value.trim();if(m===""){ue("Invalid input.","negative");return}const[y,v]=await B(m);ue(`${y}/${v} Imported.`),r.value=""}catch(m){console.error(m),ue("Something went wrong.","negative")}finally{t.value.stop(),i.value=!1}}};return(m,y)=>(_e(),qe(ft,{class:"row items-center justify-evenly",title:"Replay Importer"},{default:ce(()=>[W(at(Pt),{ref_key:"bar",ref:t,position:"top",color:"accent",size:"10px","skip-hijack":""},null,512),Ke("div",Mt,[At,o.length>0?(_e(),qe(xt,{key:0,style:{height:"200px"},class:"q-mt-md q-gutter-sm"},{default:ce(()=>[W(zt,{nodes:s.value,"node-key":"key",expanded:a.value,"onUpdate:expanded":y[0]||(y[0]=v=>a.value=v)},null,8,["nodes","expanded"])]),_:1})):rt("",!0),W(dt,{onSubmit:M,class:"q-mt-md"},{default:ce(()=>[W(ut,{outlined:"",modelValue:r.value,"onUpdate:modelValue":y[1]||(y[1]=v=>r.value=v),label:"Replay URLs",autogrow:"",type:"textarea"},null,8,["modelValue"]),W(Te,{class:"q-mt-md",color:"primary",label:"Import All",type:"submit",loading:i.value},null,8,["loading"]),W(Te,{class:"q-mt-md q-ml-md",color:"primary",label:"Clear Results",onClick:c,loading:i.value},null,8,["loading"])]),_:1})])]),_:1}))}});export{Rt as default};
