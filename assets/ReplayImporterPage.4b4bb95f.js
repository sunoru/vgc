import{ah as G,ai as Re,k as ye,r as M,aj as He,c as S,w as me,h as x,g as pe,t as Qe,ak as De,al as Ue,Q as ze,W as xe,u as be,am as We,an as we,ao as Ve,Y as Ge,ap as Je,n as Ee,B as Ze,o as Xe,d as Ye,A as et,J as tt,C as _e,D as qe,E as de,f as V,M as at,ag as Ne,G as rt,L as Te,aq as it,ar as lt}from"./index.726de0e7.js";import{Q as nt,a as st,s as fe,b as ot}from"./dialog.56451bf7.js";import{u as Be,a as Ke}from"./use-dark.3f700985.js";import{Q as Ce,b as Z,s as Me,e as he,T as Pe}from"./format.9c9c2e30.js";import{Q as ct}from"./QScrollObserver.af8de2de.js";import{Q as ut}from"./QInput.bb64b965.js";import{Q as dt}from"./QForm.7dc8cd49.js";import{_ as ft}from"./PageBase.2920f82f.js";import"./use-checkbox.6c0a9416.js";import"./QPage.e703480b.js";function re(e){return(""+e).toLowerCase().replace(/[^a-z0-9]+/g,"")}var ht=new Set(["chatmsg","chatmsg-raw","raw","error","html","inactive","inactiveoff","warning","title","formats","selectorhtml","pagehtml","fieldhtml","controlshtml","bigerror","debug","tier","challstr","popup","","customgroups","notify"]),ie=new class{constructor(){this.ARGS={"|init|":1,"|title|":1,"|users|":1,"||":1,"|html|":1,"|uhtml|":1,"|pagehtml|":1,"|uhtmlchange|":1,"|join|":1,"|leave|":1,"|name|":1,"|chat|":1,"|notify|":1,"|:|":1,"|c:|":1,"|t:|":1,"|battle|":1,"|popup|":1,"|pm|":1,"|usercount|":1,"|nametaken|":1,"|challstr|":1,"|updateuser|":1,"|formats|":1,"|updatesearch|":1,"|message|":1,"|updatechallenges|":1,"|queryresponse|":1,"|unlink|":1,"|raw|":1,"|error|":1,"|bigerror|":1,"|chatmsg|":1,"|chatmsg-raw|":1,"|controlshtml|":1,"|fieldhtml|":1,"|debug|":1,"|deinit|":1,"|selectorhtml|":1,"|refresh|":1,"|tempnotify|":1,"|tempnotifyoff|":1,"|noinit|":1,"|hidelines|":1,"|expire|":1,"|askreg|":1,"|tournament|create|":1,"|tournament|update|":1,"|tournament|updateEnd|":1,"|tournament|error|":1,"|tournament|forceend|":1,"|tournament|join|":1,"|tournament|leave|":1,"|tournament|replace|":1,"|tournament|start|":1,"|tournament|disqualify|":1,"|tournament|battlestart|":1,"|tournament|battleend|":1,"|tournament|end|":1,"|tournament|scouting|":1,"|tournament|autostart|":1,"|tournament|autodq|":1,"|player|":1,"|teamsize|":1,"|gametype|":1,"|gen|":1,"|tier|":1,"|rated|":1,"|seed|":1,"|rule|":1,"|teampreview|":1,"|clearpoke|":1,"|poke|":1,"|start|":1,"|done|":1,"|request|":1,"|inactive|":1,"|inactiveoff|":1,"|upkeep|":1,"|turn|":1,"|win|":1,"|tie|":1,"|move|":1,"|switch|":1,"|drag|":1,"|detailschange|":1,"|replace|":1,"|swap|":1,"|cant|":1,"|faint|":1,"|-formechange|":1,"|-fail|":1,"|-block|":1,"|-notarget|":1,"|-miss|":1,"|-damage|":1,"|-heal|":1,"|-sethp|":1,"|-status|":1,"|-curestatus|":1,"|-cureteam|":1,"|-boost|":1,"|-unboost|":1,"|-setboost|":1,"|-swapboost|":1,"|-invertboost|":1,"|-clearboost|":1,"|-clearallboost|":1,"|-clearpositiveboost|":1,"|-ohko|":1,"|-clearnegativeboost|":1,"|-copyboost|":1,"|-weather|":1,"|-fieldstart|":1,"|-fieldend|":1,"|-sidestart|":1,"|-sideend|":1,"|-start|":1,"|-end|":1,"|-crit|":1,"|-supereffective|":1,"|-resisted|":1,"|-immune|":1,"|-item|":1,"|-enditem|":1,"|-ability|":1,"|-endability|":1,"|-transform|":1,"|-mega|":1,"|-primal|":1,"|-burst|":1,"|-zpower|":1,"|-zbroken|":1,"|-activate|":1,"|-fieldactivate|":1,"|-hint|":1,"|-center|":1,"|-message|":1,"|-combine|":1,"|-waiting|":1,"|-prepare|":1,"|-mustrecharge|":1,"|-hitcount|":1,"|-singlemove|":1,"|-singleturn|":1,"|-anim|":1,"|warning|":1,"|-candynamax|":1,"|updatepoke|":1,"|-swapsideconditions|":1,"|-terastallize|":1,"|sentchoice|":1,"|customgroups|":1},this.ARGS_WITH_KWARGS={"|move|":1,"|switch|":1,"|cant|":1,"|-formechange|":1,"|-fail|":1,"|-block|":1,"|-damage|":1,"|-heal|":1,"|-sethp|":1,"|-status|":1,"|swap|":1,"|-curestatus|":1,"|-cureteam|":1,"|-boost|":1,"|-unboost|":1,"|-setboost|":1,"|-swapboost|":1,"|-invertboost|":1,"|-clearnegativeboost|":1,"|-weather|":1,"|-fieldstart|":1,"|-fieldend|":1,"|-sidestart|":1,"|-singlemove|":1,"|-sideend|":1,"|-start|":1,"|-end|":1,"|-immune|":1,"|-item|":1,"|-enditem|":1,"|-ability|":1,"|-endability|":1,"|-transform|":1,"|-activate|":1,"|-singleturn|":1,"|-clearallboost|":1,"|-anim|":1,"|-copyboost|":1,"|-clearboost|":1,"|-miss|":1}}*parse(e){const t=e.split(`
`);let a="";for(const[i,o]of t.entries())if(i===0&&o[0]===">"){a=o.slice(1);continue}else if(o){const{args:c,kwArgs:s}=this.parseBattleLine(o);yield{roomid:a,args:c,kwArgs:s}}}key(e,t=!1){const a=e[0]==="tournament"?`|${e[0]}|${e[1]}|`:`|${e[0]}|`;return t||a in this.ARGS?a:void 0}parseLine(e,t){if(!e.startsWith("|"))return["",e];if(e==="|")return["done"];const a=e.indexOf("|",1),i=e.slice(1,a);if(ht.has(i))return J([i,e.slice(a+1)]);switch(i){case"c":case"chat":case"uhtml":case"uhtmlchange":const o=e.indexOf("|",a+1);return J([i,e.slice(a+1,o),e.slice(o+1)]);case"c:":case"pm":const c=e.indexOf("|",a+1),s=e.indexOf("|",c+1);return J([i,e.slice(a+1,c),e.slice(c+1,s),e.slice(s+1)])}return t?null:J(e.slice(1).split("|"))}parseBattleLine(e){let t=ie.parseLine(e,!0);if(t)return{args:t,kwArgs:{}};t=e.slice(1).split("|");const a={};for(;t.length>1;){const i=t[t.length-1];if(i.charAt(0)!=="[")break;const o=i.indexOf("]");if(o<=0)break;a[i.slice(1,o)]=i.slice(o+1).trim()||!0,t.pop()}return gt({args:J(t),kwArgs:a})}parsePokemonIdent(e){const t=e.indexOf(":"),a=e.slice(0,t),i=e.slice(t+2);let o,c;return a.length<3?(o=a,c=null):(o=a.slice(0,2),c=a.charAt(2)),{player:o,position:c,name:i}}parseDetails(e,t,a="",i={}){i.details=a;const o=!e;i.name=e,i.speciesForme=e,i.level=100,i.shiny=!1,i.gender=void 0,i.ident=o?"":t,i.searchid=o?"":`${t}|${a}`;const c=a.split(", ");c[c.length-1].startsWith("tera:")&&(i.terastallized=c[c.length-1].slice(5),c.pop()),c[c.length-1]==="shiny"&&(i.shiny=!0,c.pop());const s=c[c.length-1];return(s==="M"||s==="F")&&(i.gender=s,c.pop()),c[1]&&(i.level=parseInt(c[1].substr(1))||100),c[0]&&(i.speciesForme=c[0]),i}parseHealth(e,t={}){const[a,i]=e.split(" ");if(t.hpcolor="",a==="0"||a==="0.0")t.maxhp||(t.maxhp=100),t.hp=0;else if(a.indexOf("/")>0){const[o,c]=a.split("/");if(isNaN(parseFloat(o))||isNaN(parseFloat(c)))return null;t.hp=parseFloat(o),t.maxhp=parseFloat(c),t.hp>t.maxhp&&(t.hp=t.maxhp);const s=c.slice(-1);(s==="y"||s==="g")&&(t.hpcolor=s)}else isNaN(parseFloat(a))||(t.maxhp||(t.maxhp=100),t.hp=t.maxhp*parseFloat(a)/100);return i?i==="par"||i==="brn"||i==="slp"||i==="frz"||i==="tox"||i==="psn"&&t.status!=="tox"?t.status=i:i==="fnt"&&(t.hp=0,t.fainted=!0):t.status=void 0,t}parseEffect(e,t=a=>a.trim()){return e?e.startsWith("item:")||e.startsWith("move:")?{name:t(e.slice(5)),type:e.slice(0,4)}:e.startsWith("ability:")?{name:t(e.slice(8)),type:"ability"}:{name:t(e)}:{name:t("")}}parseRequest(e){const t=JSON.parse(e);if(t.requestType||(t.requestType="move",t.forceSwitch?t.requestType="switch":t.teamPreview?t.requestType="team":t.wait&&(t.requestType="wait")),t.requestType==="wait"&&(t.noCancel=!0),t.side)for(const a of t.side.pokemon)this.parseDetails(a.ident.substr(4),a.ident,a.details,a),this.parseHealth(a.condition,a),a.ability=a.ability||a.baseAbility;if(t.active){t.active=t.active.map((a,i)=>t.side.pokemon[i].fainted?null:a);for(const a of t.active)if(!!a){for(const i of a.moves)i.move&&(i.name=i.move),i.id=re(i.name);if(a.maxMoves){a.maxMoves.maxMoves&&(a.canGigantamax=a.maxMoves.gigantamax,a.maxMoves=a.maxMoves.maxMoves);for(const i of a.maxMoves)i.id=i.move}if(a.canZMove){a.zMoves=a.canZMove;for(const i of a.zMoves)!i||(i.move&&(i.name=i.move),i.id=re(i.name))}}}return t}parseChallenges(e){return JSON.parse(e)}parseSearchState(e){return JSON.parse(e)}parseTournamentUpdate(e){return JSON.parse(e)}parseCustomGroupsJSON(e){return JSON.parse(e)}parseNameParts(e){let t="";/[A-Za-z0-9]/.test(e.charAt(0))||(t=e.charAt(0),e=e.slice(1));let a=e;const i=e.indexOf("@");let o="",c=!1;return i>0&&(a=e.slice(0,i),o=e.slice(i+1),o.startsWith("!")&&(c=!0,o=o.slice(1))),{group:t,name:a,away:c,status:o}}};function J(e){switch(e[0]){case"name":case"n":case"N":{const[t,a,i]=e;return["name",a,i,t==="N"]}case"chat":case"c":{const[,t,a]=e;return["chat",t,a]}case"join":case"j":case"J":{const[t,a]=e;return["join",a,t==="J"]}case"leave":case"l":case"L":{const[t,a]=e;return["leave",a,t==="L"]}case"battle":case"b":{const[,t,a,i]=e;return["battle",t,a,i]}}return e}var vt=new Set(["ingrain","quickguard","wideguard","craftyshield","matblock","protect","mist","safeguard","electricterrain","mistyterrain","psychicterrain","telepathy","stickyhold","suctioncups","aromaveil","flowerveil","sweetveil","disguise","safetygoggles","protectivepads"]),mt=new Set(["ability: Damp","ability: Dazzling","ability: Queenly Majesty","ability: Armor Tail"]),bt=new Set(["thundercage","clamp","whirlpool","firespin","magmastorm","sandtomb","infestation","trapped","bind","snaptrap","wrap"]),yt=new Set(["eeriespell","gmaxdepletion","spite","grudge","forewarn","sketch","leppaberry","mysteryberry"]),pt=new Set(["dryskin","eartheater","voltabsorb","waterabsorb"]);function gt({args:e,kwArgs:t}){switch(e[0]){case"-activate":{if(t.item||t.move||t.number||t.ability)return{args:e,kwArgs:t};const[,a,i,o,c]=e,s=i,r=t.of,v=ie.parseEffect(s,re).name;if(t.block)return{args:["-fail",a],kwArgs:t};if(v==="sturdy")return{args:["-activate",a,"ability: Sturdy"],kwArgs:t};if(v==="wonderguard")return{args:["-immune",a],kwArgs:{from:"ability: Wonder Guard"}};if(v==="beatup"&&t.of)return{args:e,kwArgs:{name:t.of}};if(vt.has(v))return r?(t.of=a,{args:["-block",r,s,o||""],kwArgs:t}):{args:["-block",a,s,o||""],kwArgs:t};if(v==="charge")return{args:["-singlemove",a,"Charge"],kwArgs:{of:r||void 0}};if(bt.has(v))return{args:["-start",a,s],kwArgs:{of:r||""}};if(v==="fairylock")return{args:["-fieldactivate",s],kwArgs:{}};if(v==="symbiosis"||v==="poltergeist")t.item=o;else if(v==="magnitude")t.number=o;else if(v==="skillswap"||v==="mummy"||v==="lingeringaroma")t.ability=o,t.ability2=c;else if(v==="wanderingspirit")if(o)t.ability=o,t.ability2=c;else return{args:["-ability",a,"Wandering Spirit"],kwArgs:{}};else yt.has(v)&&(t.move=o,t.number=c);return{args:["-activate",a,s,r||""],kwArgs:t}}case"-start":{(t.from==="Protean"||t.from==="Color Change")&&(t.from="ability:"+t.from);break}case"move":{t.from==="Magic Bounce"&&(t.from="ability: Magic Bounce");break}case"cant":{const[,a,i,o]=e;if(mt.has(i))return{args:["-block",a,i,o,t.of||""],kwArgs:{}};break}case"-heal":{const a=ie.parseEffect(t.from,re).name;pt.has(a)&&(t.of="");break}case"gen":{const[,a]=e;return{args:["gen",Number(a)],kwArgs:{}}}case"-restoreboost":{e[0]="-clearnegativeboost";break}case"-nothing":e=["-activate","","move: Splash"]}return{args:e,kwArgs:t}}const ae=e=>{if(e=e.slice(0,2),e==="p1")return!0;if(e==="p2")return!1;throw new Error("Only two player battles are supported.")},kt=(e,t)=>{if(t.has(e))return t.get(e);const a={id:e.split(",")[0],moves:[],sentOutOrder:t.size};return t.set(e,a),a},Ae=(e,t,a)=>{if(!(a in e))return;const i=e[a],[o,c]=t.split(":");switch(o.trim()){case"item":if(i.item)break;i.item=c.trim();break;case"ability":if(i.ability)break;i.ability=c.trim();break}},St=async(e,t={})=>{var E;const a=[],i=[],o=new Map,c=new Map,s={},r={remarks:t.remarks,tags:((E=t.tags)==null?void 0:E.map(P=>P.trim()))||[],team1:a,team2:i};let v=0;for await(const P of ie.parse(e)){const{args:m}=P,p=m[0];if(p==="t:"&&(r.time||(r.time=parseInt(m[1])*1e3)),p==="player"){const[,h,b,,T]=m,k=T?parseInt(T):0;ae(h)?(r.p1=b,r.rating1=k):(r.p2=b,r.rating2=k)}else if(p==="poke"){const h=m[2].split(",")[0];ae(m[1])?a.push(h):i.push(h)}else if(p==="switch"||p==="drag"){const[,h,b]=m,T=kt(b,ae(h)?o:c);s[h]=T}else if(p==="-ability"){const[,h,b]=m;s[h].ability=b}else if(p==="-terastallize"){const[,h,b]=m;s[h].teraType=b}else if(p==="move"){const[,h,b]=m,T=s[h].moves;T.includes(b)||T.push(b)}else if(p==="-enditem"){const[,h,b]=m;s[h].item=b}else if(p==="-activate"){const[,h,b]=m;h&&(b.startsWith("item:")?s[h].item=b.slice(5).trim():b.startsWith("ability:")&&(s[h].ability=b.slice(8).trim()))}else if(p==="detailschange"){const[,h,b]=m,T=ae(h)?o:c,k=s[h];let q;for(const[C,O]of T.entries())if(O===k){q=C;break}q&&T.delete(q),T.set(b,k)}else if(p==="turn")v=parseInt(m[1]);else if(p==="win")r.winner=m[1]===r.p1?G.Player1:G.Player2;else if("from"in P.kwArgs)if("of"in P.kwArgs)Ae(s,P.kwArgs.from,P.kwArgs.of);else{const[,h]=m;Ae(s,P.kwArgs.from,h)}}const N=(P,m)=>P.sentOutOrder-m.sentOutOrder;return r.team1SentOut=Array.from(o.values()).sort(N),r.team2SentOut=Array.from(c.values()).sort(N),r.numTurns=v,t.whichIsUserPlayer&&r.p1&&r.p2?r.userPlayer=await t.whichIsUserPlayer(r.p1,r.p2):r.userPlayer=G.Unknown,r.timeParsed=Date.now(),new Re(r)},zt=async(e,t={})=>{const a=t.password;let i=e.match(/^https?:\/\//i)?e:`https://replay.pokemonshowdown.com/${e}${a?`-${a}`:""}`;i.endsWith(".json")&&(i=i.slice(0,-5)),i.endsWith(".log")&&(i=i.slice(0,-4));const o=`${i}.json`,s=await(await fetch(o)).json(),r=s.log,v=await St(r,t);return v.id=s.id,v.url=i,v.format=s.format,v.formatid=s.formatid,v.rating=s.rating,v},xt=["none","strict","leaf","leaf-filtered"];var wt=ye({name:"QTree",props:{...Be,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:e=>xt.includes(e)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(e,{slots:t,emit:a}){const{proxy:i}=pe(),{$q:o}=i,c=Ke(e,o),s=M({}),r=M(e.ticked||[]),v=M(e.expanded||[]);let N={};He(()=>{N={}});const E=S(()=>`q-tree q-tree--${e.dense===!0?"dense":"standard"}`+(e.noConnectors===!0?" q-tree--no-connectors":"")+(c.value===!0?" q-tree--dark":"")+(e.color!==void 0?` text-${e.color}`:"")),P=S(()=>e.selected!==void 0),m=S(()=>e.icon||o.iconSet.tree.icon),p=S(()=>e.controlColor||e.color),h=S(()=>e.textColor!==void 0?` text-${e.textColor}`:""),b=S(()=>{const n=e.selectedColor||e.color;return n?` text-${n}`:""}),T=S(()=>e.filterMethod!==void 0?e.filterMethod:(n,d)=>{const l=d.toLowerCase();return n[e.labelKey]&&n[e.labelKey].toLowerCase().indexOf(l)!==-1}),k=S(()=>{const n={},d=(l,g)=>{const f=l.tickStrategy||(g?g.tickStrategy:e.tickStrategy),_=l[e.nodeKey],A=l[e.childrenKey]&&Array.isArray(l[e.childrenKey])&&l[e.childrenKey].length!==0,U=l.disabled!==!0&&P.value===!0&&l.selectable!==!1,j=l.disabled!==!0&&l.expandable!==!1,Le=f!=="none",te=f==="strict",ke=f==="leaf-filtered",ce=f==="leaf"||f==="leaf-filtered";let ue=l.disabled!==!0&&l.tickable!==!1;ce===!0&&ue===!0&&g&&g.tickable!==!0&&(ue=!1);let W=l.lazy;W===!0&&s.value[_]!==void 0&&Array.isArray(l[e.childrenKey])===!0&&(W=s.value[_]);const z={key:_,parent:g,isParent:A,lazy:W,disabled:l.disabled,link:l.disabled!==!0&&(U===!0||j===!0&&(A===!0||W===!0)),children:[],matchesFilter:e.filter?T.value(l,e.filter):!0,selected:_===e.selected&&U===!0,selectable:U,expanded:A===!0?v.value.includes(_):!1,expandable:j,noTick:l.noTick===!0||te!==!0&&W&&W!=="loaded",tickable:ue,tickStrategy:f,hasTicking:Le,strictTicking:te,leafFilteredTicking:ke,leafTicking:ce,ticked:te===!0?r.value.includes(_):A===!0?!1:r.value.includes(_)};if(n[_]=z,A===!0&&(z.children=l[e.childrenKey].map($=>d($,z)),e.filter&&(z.matchesFilter!==!0?z.matchesFilter=z.children.some($=>$.matchesFilter):z.noTick!==!0&&z.disabled!==!0&&z.tickable===!0&&ke===!0&&z.children.every($=>$.matchesFilter!==!0||$.noTick===!0||$.tickable!==!0)===!0&&(z.tickable=!1)),z.matchesFilter===!0&&(z.noTick!==!0&&te!==!0&&z.children.every($=>$.noTick)===!0&&(z.noTick=!0),ce))){if(z.ticked=!1,z.indeterminate=z.children.some($=>$.indeterminate===!0),z.tickable=z.tickable===!0&&z.children.some($=>$.tickable),z.indeterminate!==!0){const $=z.children.reduce((Se,Ie)=>Ie.ticked===!0?Se+1:Se,0);$===z.children.length?z.ticked=!0:$>0&&(z.indeterminate=!0)}z.indeterminate===!0&&(z.indeterminateNextState=z.children.every($=>$.tickable!==!0||$.ticked!==!0))}return z};return e.nodes.forEach(l=>d(l,null)),n});me(()=>e.ticked,n=>{r.value=n}),me(()=>e.expanded,n=>{v.value=n});function q(n){const d=[].reduce,l=(g,f)=>{if(g||!f)return g;if(Array.isArray(f)===!0)return d.call(Object(f),l,g);if(f[e.nodeKey]===n)return f;if(f[e.childrenKey])return l(null,f[e.childrenKey])};return l(null,e.nodes)}function C(){return r.value.map(n=>q(n))}function O(){return v.value.map(n=>q(n))}function B(n){return n&&k.value[n]?k.value[n].expanded:!1}function R(){e.expanded!==void 0?a("update:expanded",[]):v.value=[]}function I(){const n=[],d=l=>{l[e.childrenKey]&&l[e.childrenKey].length!==0&&l.expandable!==!1&&l.disabled!==!0&&(n.push(l[e.nodeKey]),l[e.childrenKey].forEach(d))};e.nodes.forEach(d),e.expanded!==void 0?a("update:expanded",n):v.value=n}function H(n,d,l=q(n),g=k.value[n]){if(g.lazy&&g.lazy!=="loaded"){if(g.lazy==="loading")return;s.value[n]="loading",Array.isArray(l[e.childrenKey])!==!0&&(l[e.childrenKey]=[]),a("lazyLoad",{node:l,key:n,done:f=>{s.value[n]="loaded",l[e.childrenKey]=Array.isArray(f)===!0?f:[],Qe(()=>{const _=k.value[n];_&&_.isParent===!0&&Y(n,!0)})},fail:()=>{delete s.value[n],l[e.childrenKey].length===0&&delete l[e.childrenKey]}})}else g.isParent===!0&&g.expandable===!0&&Y(n,d)}function Y(n,d){let l=v.value;const g=e.expanded!==void 0;if(g===!0&&(l=l.slice()),d){if(e.accordion&&k.value[n]){const f=[];k.value[n].parent?k.value[n].parent.children.forEach(_=>{_.key!==n&&_.expandable===!0&&f.push(_.key)}):e.nodes.forEach(_=>{const A=_[e.nodeKey];A!==n&&f.push(A)}),f.length!==0&&(l=l.filter(_=>f.includes(_)===!1))}l=l.concat([n]).filter((f,_,A)=>A.indexOf(f)===_)}else l=l.filter(f=>f!==n);g===!0?a("update:expanded",l):v.value=l}function ne(n){return n&&k.value[n]?k.value[n].ticked:!1}function L(n,d){let l=r.value;const g=e.ticked!==void 0;g===!0&&(l=l.slice()),d?l=l.concat(n).filter((f,_,A)=>A.indexOf(f)===_):l=l.filter(f=>n.includes(f)===!1),g===!0&&a("update:ticked",l)}function ee(n,d,l){const g={tree:i,node:n,key:l,color:e.color,dark:c.value};return we(g,"expanded",()=>d.expanded,f=>{f!==d.expanded&&H(l,f)}),we(g,"ticked",()=>d.ticked,f=>{f!==d.ticked&&L([l],f)}),g}function F(n){return(e.filter?n.filter(d=>k.value[d[e.nodeKey]].matchesFilter):n).map(d=>u(d))}function se(n){if(n.icon!==void 0)return x(ze,{class:"q-tree__icon q-mr-sm",name:n.icon,color:n.iconColor});const d=n.img||n.avatar;if(d)return x("img",{class:`q-tree__${n.img?"img":"avatar"} q-mr-sm`,src:d})}function oe(){a("afterShow")}function Q(){a("afterHide")}function u(n){const d=n[e.nodeKey],l=k.value[d],g=n.header&&t[`header-${n.header}`]||t["default-header"],f=l.isParent===!0?F(n[e.childrenKey]):[],_=f.length!==0||l.lazy&&l.lazy!=="loaded";let A=n.body&&t[`body-${n.body}`]||t["default-body"];const U=g!==void 0||A!==void 0?ee(n,l,d):null;return A!==void 0&&(A=x("div",{class:"q-tree__node-body relative-position"},[x("div",{class:h.value},[A(U)])])),x("div",{key:d,class:`q-tree__node relative-position q-tree__node--${_===!0?"parent":"child"}`},[x("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(l.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(l.selected===!0?" q-tree__node--selected":"")+(l.disabled===!0?" q-tree__node--disabled":""),tabindex:l.link===!0?0:-1,ariaExpanded:f.length>0?l.expanded:null,role:"treeitem",onClick:j=>{w(n,l,j)},onKeypress(j){De(j)!==!0&&(j.keyCode===13?w(n,l,j,!0):j.keyCode===32&&K(n,l,j,!0))}},[x("div",{class:"q-focus-helper",tabindex:-1,ref:j=>{N[l.key]=j}}),l.lazy==="loading"?x(Ue,{class:"q-tree__spinner",color:p.value}):_===!0?x(ze,{class:"q-tree__arrow"+(l.expanded===!0?" q-tree__arrow--rotate":""),name:m.value,onClick(j){K(n,l,j)}}):null,l.hasTicking===!0&&l.noTick!==!0?x(nt,{class:"q-tree__tickbox",modelValue:l.indeterminate===!0?null:l.ticked,color:p.value,dark:c.value,dense:!0,keepColor:!0,disable:l.tickable!==!0,onKeydown:xe,"onUpdate:modelValue":j=>{D(l,j)}}):null,x("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(l.selected===!0?b.value:h.value)},[g?g(U):[se(n),x("div",n[e.labelKey])]])]),_===!0?e.noTransition===!0?l.expanded===!0?x("div",{class:"q-tree__node-collapsible"+h.value,key:`${d}__q`},[A,x("div",{class:"q-tree__children"+(l.disabled===!0?" q-tree__node--disabled":""),role:"group"},f)]):null:x(st,{duration:e.duration,onShow:oe,onHide:Q},()=>be(x("div",{class:"q-tree__node-collapsible"+h.value,key:`${d}__q`},[A,x("div",{class:"q-tree__children"+(l.disabled===!0?" q-tree__node--disabled":""),role:"group"},f)]),[[We,l.expanded]])):A])}function y(n){const d=N[n];d&&d.focus()}function w(n,d,l,g){g!==!0&&d.selectable!==!1&&y(d.key),P.value&&d.selectable?e.noSelectionUnset===!1?a("update:selected",d.key!==e.selected?d.key:null):d.key!==e.selected&&a("update:selected",d.key===void 0?null:d.key):K(n,d,l,g),typeof n.handler=="function"&&n.handler(n)}function K(n,d,l,g){l!==void 0&&xe(l),g!==!0&&d.selectable!==!1&&y(d.key),H(d.key,!d.expanded,n,d)}function D(n,d){if(n.indeterminate===!0&&(d=n.indeterminateNextState),n.strictTicking)L([n.key],d);else if(n.leafTicking){const l=[],g=f=>{f.isParent?(d!==!0&&f.noTick!==!0&&f.tickable===!0&&l.push(f.key),f.leafTicking===!0&&f.children.forEach(g)):f.noTick!==!0&&f.tickable===!0&&(f.leafFilteredTicking!==!0||f.matchesFilter===!0)&&l.push(f.key)};g(n),L(l,d)}}return e.defaultExpandAll===!0&&I(),Object.assign(i,{getNodeByKey:q,getTickedNodes:C,getExpandedNodes:O,isExpanded:B,collapseAll:R,expandAll:I,setExpanded:H,isTicked:ne,setTicked:L}),()=>{const n=F(e.nodes);return x("div",{class:E.value,role:"tree"},n.length===0?e.filter?e.noResultsLabel||o.lang.tree.noResults:e.noNodesLabel||o.lang.tree.noNodes:n)}}});const $e=["vertical","horizontal"],ve={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Oe={prevent:!0,mouse:!0,mouseAllDir:!0},je=e=>e>=250?50:Math.ceil(e/5);var _t=ye({name:"QScrollArea",props:{...Be,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:a}){const i=M(!1),o=M(!1),c=M(!1),s={vertical:M(0),horizontal:M(0)},r={vertical:{ref:M(null),position:M(0),size:M(0)},horizontal:{ref:M(null),position:M(0),size:M(0)}},{proxy:v}=pe(),N=Ke(e,v.$q);let E=null,P;const m=M(null),p=S(()=>"q-scrollarea"+(N.value===!0?" q-scrollarea--dark":""));r.vertical.percentage=S(()=>{const u=r.vertical.size.value-s.vertical.value;if(u<=0)return 0;const y=Z(r.vertical.position.value/u,0,1);return Math.round(y*1e4)/1e4}),r.vertical.thumbHidden=S(()=>(e.visible===null?c.value:e.visible)!==!0&&i.value===!1&&o.value===!1||r.vertical.size.value<=s.vertical.value+1),r.vertical.thumbStart=S(()=>r.vertical.percentage.value*(s.vertical.value-r.vertical.thumbSize.value)),r.vertical.thumbSize=S(()=>Math.round(Z(s.vertical.value*s.vertical.value/r.vertical.size.value,je(s.vertical.value),s.vertical.value))),r.vertical.style=S(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${r.vertical.thumbStart.value}px`,height:`${r.vertical.thumbSize.value}px`})),r.vertical.thumbClass=S(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(r.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),r.vertical.barClass=S(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(r.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),r.horizontal.percentage=S(()=>{const u=r.horizontal.size.value-s.horizontal.value;if(u<=0)return 0;const y=Z(Math.abs(r.horizontal.position.value)/u,0,1);return Math.round(y*1e4)/1e4}),r.horizontal.thumbHidden=S(()=>(e.visible===null?c.value:e.visible)!==!0&&i.value===!1&&o.value===!1||r.horizontal.size.value<=s.horizontal.value+1),r.horizontal.thumbStart=S(()=>r.horizontal.percentage.value*(s.horizontal.value-r.horizontal.thumbSize.value)),r.horizontal.thumbSize=S(()=>Math.round(Z(s.horizontal.value*s.horizontal.value/r.horizontal.size.value,je(s.horizontal.value),s.horizontal.value))),r.horizontal.style=S(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[v.$q.lang.rtl===!0?"right":"left"]:`${r.horizontal.thumbStart.value}px`,width:`${r.horizontal.thumbSize.value}px`})),r.horizontal.thumbClass=S(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(r.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),r.horizontal.barClass=S(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(r.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const h=S(()=>r.vertical.thumbHidden.value===!0&&r.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),b=[[Pe,u=>{I(u,"vertical")},void 0,{vertical:!0,...Oe}]],T=[[Pe,u=>{I(u,"horizontal")},void 0,{horizontal:!0,...Oe}]];function k(){const u={};return $e.forEach(y=>{const w=r[y];u[y+"Position"]=w.position.value,u[y+"Percentage"]=w.percentage.value,u[y+"Size"]=w.size.value,u[y+"ContainerSize"]=s[y].value}),u}const q=Ve(()=>{const u=k();u.ref=v,a("scroll",u)},0);function C(u,y,w){if($e.includes(u)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(u==="vertical"?Me:he)(m.value,y,w)}function O({height:u,width:y}){let w=!1;s.vertical.value!==u&&(s.vertical.value=u,w=!0),s.horizontal.value!==y&&(s.horizontal.value=y,w=!0),w===!0&&L()}function B({position:u}){let y=!1;r.vertical.position.value!==u.top&&(r.vertical.position.value=u.top,y=!0),r.horizontal.position.value!==u.left&&(r.horizontal.position.value=u.left,y=!0),y===!0&&L()}function R({height:u,width:y}){r.horizontal.size.value!==y&&(r.horizontal.size.value=y,L()),r.vertical.size.value!==u&&(r.vertical.size.value=u,L())}function I(u,y){const w=r[y];if(u.isFirst===!0){if(w.thumbHidden.value===!0)return;P=w.position.value,o.value=!0}else if(o.value!==!0)return;u.isFinal===!0&&(o.value=!1);const K=ve[y],D=s[y].value,n=(w.size.value-D)/(D-w.thumbSize.value),d=u.distance[K.dist],l=P+(u.direction===K.dir?1:-1)*d*n;ee(l,y)}function H(u,y){const w=r[y];if(w.thumbHidden.value!==!0){const K=u[ve[y].offset];if(K<w.thumbStart.value||K>w.thumbStart.value+w.thumbSize.value){const D=K-w.thumbSize.value/2;ee(D/s[y].value*w.size.value,y)}w.ref.value!==null&&w.ref.value.dispatchEvent(new MouseEvent(u.type,u))}}function Y(u){H(u,"vertical")}function ne(u){H(u,"horizontal")}function L(){i.value=!0,E!==null&&clearTimeout(E),E=setTimeout(()=>{E=null,i.value=!1},e.delay),e.onScroll!==void 0&&q()}function ee(u,y){m.value[ve[y].scroll]=u}let F=null;function se(){F!==null&&clearTimeout(F),F=setTimeout(()=>{F=null,c.value=!0},v.$q.platform.is.ios?50:0)}function oe(){F!==null&&(clearTimeout(F),F=null),c.value=!1}let Q=null;return me(()=>v.$q.lang.rtl,u=>{m.value!==null&&he(m.value,Math.abs(r.horizontal.position.value)*(u===!0?-1:1))}),Ge(()=>{Q={top:r.vertical.position.value,left:r.horizontal.position.value}}),Je(()=>{if(Q===null)return;const u=m.value;u!==null&&(he(u,Q.left),Me(u,Q.top))}),Ee(q.cancel),Object.assign(v,{getScrollTarget:()=>m.value,getScroll:k,getScrollPosition:()=>({top:r.vertical.position.value,left:r.horizontal.position.value}),getScrollPercentage:()=>({top:r.vertical.percentage.value,left:r.horizontal.percentage.value}),setScrollPosition:C,setScrollPercentage(u,y,w){C(u,y*(r[u].size.value-s[u].value)*(u==="horizontal"&&v.$q.lang.rtl===!0?-1:1),w)}}),()=>x("div",{class:p.value,onMouseenter:se,onMouseleave:oe},[x("div",{ref:m,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[x("div",{class:"q-scrollarea__content absolute",style:h.value},Ze(t.default,[x(Ce,{debounce:0,onResize:R})])),x(ct,{axis:"both",onScroll:B})]),x(Ce,{debounce:0,onResize:O}),x("div",{class:r.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Y}),x("div",{class:r.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:ne}),be(x("div",{ref:r.vertical.ref,class:r.vertical.thumbClass.value,style:r.vertical.style.value,"aria-hidden":"true"}),b),be(x("div",{ref:r.horizontal.ref,class:r.horizontal.thumbClass.value,style:r.horizontal.style.value,"aria-hidden":"true"}),T)])}});const ge=XMLHttpRequest,Fe=ge.prototype.open,qt=["top","right","bottom","left"];let le=[],X=0;function Tt({p:e,pos:t,active:a,horiz:i,reverse:o,dir:c}){let s=1,r=1;return i===!0?(o===!0&&(s=-1),t==="bottom"&&(r=-1),{transform:`translate3d(${s*(e-100)}%,${a?0:r*-200}%,0)`}):(o===!0&&(r=-1),t==="right"&&(s=-1),{transform:`translate3d(${a?0:c*s*-200}%,${r*(e-100)}%,0)`})}function Ct(e,t){return typeof t!="number"&&(e<25?t=Math.random()*3+3:e<65?t=Math.random()*3:e<85?t=Math.random()*2:e<99?t=.6:t=0),Z(e+t,0,100)}function Mt(e){X++,le.push(e),!(X>1)&&(ge.prototype.open=function(t,a){const i=[],o=()=>{le.forEach(s=>{(s.hijackFilter.value===null||s.hijackFilter.value(a)===!0)&&(s.start(),i.push(s.stop))})},c=()=>{i.forEach(s=>{s()})};this.addEventListener("loadstart",o,{once:!0}),this.addEventListener("loadend",c,{once:!0}),Fe.apply(this,arguments)})}function Pt(e){le=le.filter(t=>t.start!==e),X=Math.max(0,X-1),X===0&&(ge.prototype.open=Fe)}var At=ye({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:e=>qt.includes(e)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(e,{emit:t}){const{proxy:a}=pe(),i=M(0),o=M(!1),c=M(!0);let s=0,r=null,v;const N=S(()=>`q-loading-bar q-loading-bar--${e.position}`+(e.color!==void 0?` bg-${e.color}`:"")+(c.value===!0?"":" no-transition")),E=S(()=>e.position==="top"||e.position==="bottom"),P=S(()=>E.value===!0?"height":"width"),m=S(()=>{const C=o.value,O=Tt({p:i.value,pos:e.position,active:C,horiz:E.value,reverse:a.$q.lang.rtl===!0&&["top","bottom"].includes(e.position)?e.reverse===!1:e.reverse,dir:a.$q.lang.rtl===!0?-1:1});return O[P.value]=e.size,O.opacity=C?1:0,O}),p=S(()=>o.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":i.value}:{"aria-hidden":"true"});function h(C=300){const O=v;return v=Math.max(0,C)||0,s++,s>1?(O===0&&C>0?k():r!==null&&O>0&&C<=0&&(clearTimeout(r),r=null),s):(r!==null&&clearTimeout(r),t("start"),i.value=0,r=setTimeout(()=>{r=null,c.value=!0,C>0&&k()},o._value===!0?500:1),o._value!==!0&&(o.value=!0,c.value=!1),s)}function b(C){return s>0&&(i.value=Ct(i.value,C)),s}function T(){if(s=Math.max(0,s-1),s>0)return s;r!==null&&(clearTimeout(r),r=null),t("stop");const C=()=>{c.value=!0,i.value=100,r=setTimeout(()=>{r=null,o.value=!1},1e3)};return i.value===0?r=setTimeout(C,1):C(),s}function k(){i.value<100&&(r=setTimeout(()=>{r=null,b(),k()},v))}let q;return Xe(()=>{e.skipHijack!==!0&&(q=!0,Mt({start:h,stop:T,hijackFilter:S(()=>e.hijackFilter||null)}))}),Ee(()=>{r!==null&&clearTimeout(r),q===!0&&Pt(h)}),Object.assign(a,{start:h,stop:T,increment:b}),()=>x("div",{class:N.value,style:m.value,...p.value})}});const $t={class:"q-pa-md col",style:{"max-width":"720px"}},Ot=Ne("div",{class:"text-h3"},"Replay Importer",-1),Qt=Ye({__name:"ReplayImporterPage",setup(e){const t=M(),a=M(""),i=M(!1),o=et([]),c=()=>{o.splice(0)},s=S(()=>{const m=[],p=[],h=[];for(const b of o)switch(b.status){case"failed":h.push({key:h.length,label:`${b.url}	${b.remarks}	${b.tags.join(",")}`});break;case"skipped":p.push({key:p.length,label:b.battle?b.battle.id:b.url,url:b.url});break;case"succeeded":m.push({key:m.length,label:b.battle.id,url:b.url});break}return[{key:"succeeded",label:`Succeeded (${m.length})`,children:m},{key:"skipped",label:`Skipped (${p.length})`,children:p},{key:"failed",label:`Failed (${h.length})`,children:h}]}),r=M(["root","failed"]),v=tt().config,N=async(m,p,h)=>{const b=m.pathname.match(/^\/(?<id>[0-9a-z]+?-\d+?)(-(?<password>[0-9a-z]+?))?$/),T=m.toString();if(b!==null&&b.groups){const k=b.groups.id,q=await it("battles",k);if(q!==null)return{battle:q,url:T,status:"skipped"}}try{const k=await zt(m.href,{remarks:p,tags:h,whichIsUserPlayer:async(q,C)=>{const O=v.showdownUsernames;if(O.includes(q))return G.Player1;if(O.includes(C))return G.Player2;const B=await ot("Which is your username?","Nither of them",q,C);return B!==0&&v.showdownUsernames.push(B===G.Player1?q:C),B}});return await lt("battles",k),{battle:k,url:T,status:"succeeded"}}catch(k){return console.error(k),{url:T,remarks:p,tags:h,status:"failed"}}},E=async m=>{var k;const p=m.split(`
`),h=100/p.length;let b=0,T=0;for(let q of p){if((k=t.value)==null||k.increment(h),q=q.trim(),q==="")continue;const[C,O,B]=q.split("	");try{const R=new URL(C);T+=1;const I=await N(R,O,(B==null?void 0:B.split(","))||[]);I.status==="succeeded"&&(b+=1),o.push(I)}catch(R){console.error(R);continue}}return[b,T]},P=async()=>{if(!!t.value){i.value=!0,t.value.start(0);try{const m=a.value.trim();if(m===""){fe("Invalid input.","negative");return}const[p,h]=await E(m);fe(`${p}/${h} Imported.`),a.value=""}catch(m){console.error(m),fe("Something went wrong.","negative")}finally{t.value.stop(),i.value=!1}}};return(m,p)=>(_e(),qe(ft,{class:"row items-center justify-evenly",title:"Replay Importer"},{default:de(()=>[V(at(At),{ref_key:"bar",ref:t,position:"top",color:"accent",size:"10px","skip-hijack":""},null,512),Ne("div",$t,[Ot,o.length>0?(_e(),qe(_t,{key:0,style:{height:"200px"},class:"q-mt-md q-gutter-sm"},{default:de(()=>[V(wt,{nodes:s.value,"node-key":"key",expanded:r.value,"onUpdate:expanded":p[0]||(p[0]=h=>r.value=h)},null,8,["nodes","expanded"])]),_:1})):rt("",!0),V(dt,{onSubmit:P,class:"q-mt-md"},{default:de(()=>[V(ut,{outlined:"",modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=h=>a.value=h),label:"Replay URLs",autogrow:"",type:"textarea"},null,8,["modelValue"]),V(Te,{class:"q-mt-md",color:"primary",label:"Import All",type:"submit",loading:i.value},null,8,["loading"]),V(Te,{class:"q-mt-md q-ml-md",color:"primary",label:"Clear Results",onClick:c,loading:i.value},null,8,["loading"])]),_:1})])]),_:1}))}});export{Qt as default};
